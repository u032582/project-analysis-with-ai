<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>動的JSONデータのテーブル表示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 20px;
        }
        h1, h2 {
            text-align: center;
        }
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }
        table th, table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        table th {
            background-color: #f8f8f8;
            font-weight: bold;
        }
        table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>JSON データのテーブル表示</h1>
    <table id="mainTable">
        <thead>
            <tr>
                <th>フォルダ名</th>
                <th>ファイル数</th>
                <th>ディレクトリ数</th>
                <th>総サイズ (バイト)</th>
            </tr>
        </thead>
        <tbody id="folderInfo"></tbody>
    </table>

    <h2>構造</h2>
    <table id="structureTable">
        <thead>
            <tr>
                <th>フォルダパス</th>
                <th>ディレクトリ</th>
                <th>ファイル</th>
                <th>コンテンツ</th>
                <th>トークン使用量</th>
                <th>モデル名</th>
                <th>更新日時</th>
            </tr>
        </thead>
        <tbody id="structureInfo"></tbody>
    </table>

    <script>
        // JSONファイルを読み込む関数
        async function loadJSON() {
            const response = await fetch('stats_final.json'); // JSONファイルを指定
            const data = await response.json();
            displayFolderInfo(data);
            displayStructureInfo(data);
        }

        // フォルダ情報を表示する関数
        function displayFolderInfo(data) {
            const folderInfo = document.getElementById("folderInfo");
            const row = document.createElement("tr");

            row.innerHTML = `
                <td>${data.folder_name}</td>
                <td>${data.num_files}</td>
                <td>${data.num_dirs}</td>
                <td>${data.total_size}</td>
            `;
            folderInfo.appendChild(row);
        }

        // 構造情報を表示する関数
        function displayStructureInfo(data) {
            const structureInfo = document.getElementById("structureInfo");

            data.structure.forEach(item => {
                item[2].forEach((file, index) => {
                    const row = document.createElement("tr");

                    // コンテンツ情報を表示
                    const contentData = item[3][index];
                    const content = contentData ? contentData.content : "N/A";
                    const tokenUsage = contentData && contentData.response_metadata ? contentData.response_metadata.token_usage.total_tokens : "N/A";
                    const modelName = contentData && contentData.response_metadata ? contentData.response_metadata.model_name : "N/A";

                    row.innerHTML = `
                        <td>${item[0]}</td>
                        <td>${item[1].join(", ")}</td>
                        <td>${file}</td>
                        <td><pre>${content}</pre></td>
                        <td>${tokenUsage}</td>
                        <td>${modelName}</td>
                        <td>${item[4][index]}</td>
                    `;
                    structureInfo.appendChild(row);
                });
            });
        }

        // ページ読み込み時にJSONを読み込む
        window.onload = loadJSON;
    </script>
</body>
</html>
